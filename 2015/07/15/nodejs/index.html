<!DOCTYPE HTML>
<!--
	Striped 2.5 by HTML5 Up!
	html5up.net | @n33co
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
	Ported to Hexo by Adam Stokes @battlemidget
-->
<html>
  <head>
    
    <title>为什么nodejs支持高并发、非阻塞 | We are JQ</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />

    
        <meta name="author" content="Zx Qian and HH Jiang">
    
    
        <meta name="description" content="首先看一下nodejs的特点：1 js运行环境， 依赖于chrome V8引擎进行代码解释2 事件驱动3 非阻塞I/O4 轻量，可伸缩5 单进程单线程
那么nodejs怎么实现高并发和非阻塞的， 我们看一下系统瓶颈的问题：1 并发连接：1.1 系统线程模型     服务端只有一个线程， 并发请求（用">
    
    
    <script src="/js/jquery.min.js" type="text/javascript"></script>
    <script src="/js/skel.min.js" type="text/javascript"></script>
    <script src="/js/skel-panels.min.js" type="text/javascript"></script>
    <script src="/js/init.js" type="text/javascript"></script>
    <link rel="stylesheet" href="/css/style.css" type="text/css">
    <link rel="stylesheet" href="/css/style-desktop.css" type="text/css">
    <link rel="stylesheet" href="/css/style-wide.css" type="text/css">
    <link rel="alternate" href="/atom.xml" title="We are JQ" type="application/atom+xml">
    <link rel="stylesheet" href="/js/styles/tomorrow-night.css" type="text/css">
    <script src="/js/highlight.pack.js" type="text/javascript"></script>
    <script>
        hljs.initHighlightingOnLoad();
    </script>

    

  </head>


<body class="left-sidebar">
  <!-- Wrapper -->
  <div id="wrapper">
    <!-- Content -->
    <div id="content">
      <div id="content-inner">
	<!-- Post -->
<article id="post-nodejs" class="box post post-excerpt">
  <header>
    
  
    <h2>为什么nodejs支持高并发、非阻塞</h2>
  


  </header>
  <div class="info">
    <span class="date"><span class="month">Jul</span> <span class="day">15</span><span class="year">, 2015</span></span>
    <!--<ul class="stats">-->
      <!--
  <div class="addthis addthis_toolbox addthis_default_style">
    <a class="addthis_counter addthis_pill_style"></a>
  </div>
  <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js"></script>

-->
    <!--</ul>-->
  </div>
  <p>
  
    <p>首先看一下nodejs的特点：<br>1 js运行环境， 依赖于chrome V8引擎进行代码解释<br>2 事件驱动<br>3 非阻塞I/O<br>4 轻量，可伸缩<br>5 单进程单线程</p>
<p>那么nodejs怎么实现高并发和非阻塞的， 我们看一下系统瓶颈的问题：<br>1 并发连接：<br>1.1 系统线程模型<br>     服务端只有一个线程， 并发请求（用户）到达的只能处理一个，其余的要先等待，这样就是阻塞，正在享受服务的请求阻塞后面的请求。<br>1.2 多线程、线程池模型<br>     多线程： 多个业务员， 高并发的时候还是需要排队。 调节服务端线程的数目来提高对并发请求的接收和相应。由于系统内存资源的受限， 多线程是有限的</p>
<p>1.3 nodejs实现的高并发的 异步、事件驱动模型<br> 每个用户请求都会得到处理， 服务端给请求注册一个激发事件（I/O）， 并给一个回调函数， 然后再事件处理（I/O）处理完成后继续执行下一步回调函数。<br>这样子整个过程是没有阻塞新的用户的链接。<br>但是nodejs是单线程，这样子事件队列越长， 得到相应的时间越长， 并发量会力不从心。</p>
<p>解决：<br>更改连接到服务器的方式，每个连接发射（emit）一个在NodeJS引擎进程中运行的事件（Event），放进事件队列当中，<br>　　而不是为每个连接生成一个新的OS线程（并为其分配一些配套内存）</p>
<p>2  I/O阻塞</p>
<p>每个线程大概会占用 2M 的系统内存<br>2.1 针对串行获取数据，我们就是数据的相加，</p>
<p>2.2 nodejs<br>所有请求以及同时传入的回调函数均发送至同一线程，该线程通常叫做 Event loop 线程，该线程负责在 I/O 执行完毕后，将结果返回给回调函数。这里要注意的是 I/O 操作本身并不在该线程内执行，所以不会阻塞后续请求</p>
<p><img src="./img/nodejs/paixu.jpg" alt="image"><br><img src="./img/nodejs/code.jpg" alt="image"><br><img src="./img/nodejs/nodejs.jpg" alt="image"><br><img src="./img/nodejs/org.jpg" alt="image"></p>
<p>三. NodeJS的优缺点</p>
<p>　　优点：</p>
<p>　　1. 高并发（最重要的优点）</p>
<p>　　2. 适合I/O密集型应用</p>
<p>　   缺点：</p>
<p>　　1. 不适合CPU密集型应用；CPU密集型应用给Node带来的挑战主要是：由于JavaScript单线程的原因，如果有长时间运行的计算（比如大循环），将会导致CPU时间片不能释放，使得后续I/O无法发起；</p>
<p>　　　　解决方案：分解大型运算任务为多个小任务，使得运算能够适时释放，不阻塞I/O调用的发起；</p>
<p>　　2. 只支持单核CPU，不能充分利用CPU</p>
<p>　　3. 可靠性低，一旦代码某个环节崩溃，整个系统都崩溃</p>
<p>　　　　原因：单进程，单线程</p>
<p>　　　　解决方案：（1）Nnigx反向代理，负载均衡，开多个进程，绑定多个端口；</p>
<p>　　　　　　　　　（2）开多个进程监听同一个端口，使用cluster模块；</p>
<p>　　4. 开源组件库质量参差不齐，更新快，向下不兼容</p>
<p>　　5. Debug不方便，错误没有stack trace</p>

  
  </p>
  <footer class="article-footer">
    <a data-url="http://yoursite.com/2015/07/15/nodejs/" data-id="cic4c3rvp0000o4a5s155mjmn" class="article-share-link">Share</a>
    
    
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nodejs/">nodejs</a></li></ul>


  </footer>
  
    
<nav id="article-nav">
  
  
    <a href="/2015/07/14/July/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">All you had to do was stay</div>
    </a>
  
</nav>


  
</article>



      </div>
    </div>
    <div id="sidebar">
  <!-- Logo -->
  <div id="logo">
    <h1>We are JQ</h1>
    <h2></h2>
  </div>
  
  <!-- Nav -->
  <nav id="nav">
    <ul>
      
      <li><a href="/">Home</a></li>
      
      <li><a href="/archives">Archives</a></li>
      
    </ul>
  </nav>


  <!-- Hexo Widgets -->
  
    <!-- Search -->
<section class="box search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" class="text" name="q" results="0" placeholder="search">
    <input type="hidden" name="q" value="site:yoursite.com">
  </form>
</section>

  
    
  <section class="box recent-posts">
    <header>
      <h2>Recent Posts</h2>
    </header>
    <ul>
      
        <li>
          <a href="/2015/07/15/nodejs/">
            为什么nodejs支持高并发、非阻塞
          </a>
        </li>
        
        <li>
          <a href="/2015/07/14/July/">
            All you had to do was stay
          </a>
        </li>
        
        <li>
          <a href="/2015/07/13/try/">
            新的开始
          </a>
        </li>
        
        <li>
          <a href="/2015/07/12/hello-world/">
            Hello World
          </a>
        </li>
        
    </ul>
  </section>
  

  

  <!-- Copyright -->
  <div id="copyright">
  
  &copy; 2015 Zx Qian and HH Jiang
  
  Powered by: <a href="https://github.com/tommy351/hexo">Hexo</a><br />
  Designed by: <a href="http://html5up.net/">HTML5 UP</a>
  <p>
    
    
    

   </p>
</div>



</div>

    <script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>


  </div>
</body>
</html>
